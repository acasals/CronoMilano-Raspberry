{% extends "base.html" %}

{% block title %}Concurso{% endblock %}

{% block body %}

<div class="container">

    <h1 class="mb-4">Concurso en marcha</h1>

    <div class="card p-3 mb-3">
        <h3>Fase: <span id="fase">---</span></h3>
        <h2 class="display-3" id="tiempo">--</h2>
    </div>

    <div class="d-flex gap-3">

        <button id="btn_acortar" class="btn btn-warning btn-lg" style="display:none;">
            Acortar
        </button>

        <button id="btn_alargar" class="btn btn-info btn-lg" style="display:none;">
            Alargar
        </button>

        <button id="btn_stop" class="btn btn-danger btn-lg">
            STOP
        </button>

    </div>

</div>

<script>
function actualizarEstado() {
    fetch("/estado")
        .then(r => r.json())
        .then(data => {
            document.getElementById("fase").textContent = data.fase;
            document.getElementById("tiempo").textContent = data.tiempo_restante;

            // Mostrar/ocultar botones según fase
            if (["Preparación", "Vuelo", "Espera"].includes(data.fase)) {
                document.getElementById("btn_acortar").style.display = "inline-block";
            } else {
                document.getElementById("btn_acortar").style.display = "none";
            }

            if (["Preparación", "Espera"].includes(data.fase)) {
                document.getElementById("btn_alargar").style.display = "inline-block";
            } else {
                document.getElementById("btn_alargar").style.display = "none";
            }

            // Si el crono está detenido → volver a index
            if (!data.cronoenmarcha) {
                window.location.href = "/";
            }
        });
}

// Refrescar cada 500 ms
setInterval(actualizarEstado, 500);

// Botones
document.getElementById("btn_acortar").onclick = () => {
    fetch("/acortar", {method: "POST"});
};

document.getElementById("btn_alargar").onclick = () => {
    fetch("/alargar", {method: "POST"});
};

document.getElementById("btn_stop").onclick = () => {
    fetch("/stop", {method: "POST"})
        .then(() => window.location.href = "/");
};
</script>

{% endblock %}